<script src = "https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<style>
body {
        margin: 0px;
        padding: 0px;
      }
.trialDiv {
	padding-top: 50px;
	margin: 0 auto;
	width: 1000px;
	height: 400px;
	
	display: none;
	
	/*border: 1px solid red;*/
	}
#startExperiment:hover{
	color:white;
}
#instructionsEn{
	padding-top: 50px;
	margin: 0 auto;
	width: 1000px;
	
	display:none;
	
	
	font-family: Arial,Helvetica;
	font-size: 14pt;
	text-align: justify;
	
}


#instructionsCn{
	padding-top: 50px;
	margin: 0 auto;
	width: 1000px;
	
	display:none;
	
	
	font-family: Arial,Helvetica;
	font-size: 14pt;
	text-align: justify;
	
}

#consentEn{
	padding-top: 50px;
	margin: 0 auto;
	width: 1000px;
	
	font-family: Arial,Helvetica;
	font-size: 14pt;
	text-align: justify;
	display: none;
}

#consentCn{
	padding-top: 50px;
	margin: 0 auto;
	width: 1000px;
	
	font-family: Arial,Helvetica;
	font-size: 14pt;
	text-align: justify;
	display: none;
}

#debriefEn{
	padding-top: 50px;
	margin: 0 auto;
	width: 1000px;
	
	font-family: Arial,Helvetica;
	font-size: 14pt;
	text-align: justify;
	display: none;
}

#debriefCn{
	padding-top: 50px;
	margin: 0 auto;
	width: 1000px;
	
	font-family: Arial,Helvetica;
	font-size: 14pt;
	text-align: justify;
	display: none;
}
 
.questionsDiv{
	padding-top: 50px;
	margin: 0 auto;
	width: 1000px;
	
	display:none;
	
	font-family: Arial,Helvetica;
	font-size: 14pt;
	text-align: left;
	
}
 
 
 .panasDiv{
	padding-top: 50px;
	margin: 0 auto;
	width: 1000px;
	
	display:none;
	
	font-family: Arial,Helvetica;
	font-size: 14pt;
	text-align: left;
	
}

.senseNonSenseDiv{
	padding-top: 50px;
	margin: 0 auto;
	width: 1000px;
	
	display:none;

	font-family: Arial,Helvetica;
	font-size: 14pt;
	text-align: left;	
	line-height:2;
}


.demographicsDiv{
	padding-top: 50px;
	margin: 0 auto;
	width: 1000px;
	
	display:none;

	font-family: Arial,Helvetica;
	font-size: 14pt;
	text-align: left;	
	line-height:2;
}

#mortSalienceEn{
	padding-top: 50px;
	margin: 0 auto;
	width: 1000px;
	
	display:none;

	font-family: Arial,Helvetica;
	font-size: 14pt;
	text-align: left;	
	line-height:2;
}

#dentSalienceEn{
	padding-top: 50px;
	margin: 0 auto;
	width: 1000px;
	
	display:none;

	font-family: Arial,Helvetica;
	font-size: 14pt;
	text-align: left;	
	line-height:2;
}


#mortSalienceCn{
	padding-top: 50px;
	margin: 0 auto;
	width: 1000px;
	
	display:none;

	font-family: Arial,Helvetica;
	font-size: 14pt;
	text-align: left;	
	line-height:2;
}

#dentSalienceCn{
	padding-top: 50px;
	margin: 0 auto;
	width: 1000px;
	
	display:none;

	font-family: Arial,Helvetica;
	font-size: 14pt;
	text-align: left;	
	line-height:2;
}

.button {
  	-webkit-transition-duration: 0.4s; /* Safari */
  	transition-duration: 0.4s;
  	background-color: gray; 
  	color: black;
  	margin: 0 auto;
	width: 150px;
	padding: 5px;
    
  	margin-top: 100px;
	text-align: center;
	font-family: Arial,Helvetica;
	font-size: 14pt;
	float: right;
  	
}

.button:hover {
 	background-color: gray; 
  	color: white;
  	margin: 0 auto;
	width: 150px;
	padding: 5px;
	
	margin-top: 100px;
	text-align: center;
	font-family: Arial,Helvetica;
	font-size: 14pt;
	border: 4px inset gray;
	float: right;
	}
	
.disabled {
  	opacity: 0.65; 
  	cursor: not-allowed;
  	-webkit-transition-duration: 0.4s; /* Safari */
  	transition-duration: 0.4s;
  	background-color: gray; 
  	color: black;
  	margin: 0 auto;
	width: 150px;
	padding: 5px;
  	
  	margin-top: 100px;
	text-align: center;
	font-family: Arial,Helvetica;
	font-size: 14pt;
	float: right;
}

.container {
  justify-content: space-between;
  flex-direction: column;
  display: flex;
}
.container .btn-holder {
  justify-content: flex-end;
  display: flex;
}

#endOfExperimentEn{
	padding-top: 200px;
	margin: 0 auto;
	width: 1000px;
	
	display:none;
	
	font-family: Arial,Helvetica;
	font-size: 14pt;
	text-align: center;
	
}
#endOfExperimentCn{
	padding-top: 200px;
	margin: 0 auto;
	width: 1000px;
	
	display:none;
	
	font-family: Arial,Helvetica;
	font-size: 14pt;
	text-align: center;
	
}
.container {
  display: flex;
  justify-content: center;
  margin: 0px 50px 75px 100px;
}
#submitButton{
	-webkit-transition-duration: 0.4s; /* Safari */
  	transition-duration: 0.4s;
  	background-color: gray; 
  	color: black;
  	margin: 0 auto;
	width: 150px;
	padding: 5px;
	
  	margin-top: 100px;
	text-align: center;
	font-family: Arial,Helvetica;
	font-size: 14pt;
	float: right;
	display:none;
}

#submitButton:hover{
	background-color: gray; 
  	color: white;
  	margin: 0 auto;
	width: 100px;
	padding: 5px;
	
	margin-top: 100px;
	text-align: center;
	font-family: Arial,Helvetica;
	font-size: 14pt;
	border: 4px inset gray;
	float: right;
}
.radio-label {
   display: inline-block;
    vertical-align: top;
    margin-right: 3%;
}
.radio-input {
   display: inline-block;
    vertical-align: top;
}

/* Dropdown Button */
.dropbtn {
  background-color: #3498DB;
  color: white;
  padding: 16px;
  font-size: 16px;
  border: none;
  cursor: pointer;
}

/* Dropdown button on hover & focus */
.dropbtn:hover, .dropbtn:focus {
  background-color: #2980B9;
}

/* The container <div> - needed to position the dropdown content */
.dropdown {
  position: relative;
  display: inline-block;
}

/* Dropdown Content (Hidden by Default) */
.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f1f1f1;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}

/* Links inside the dropdown */
.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}

/* Change color of dropdown links on hover */
.dropdown-content a:hover {background-color: #ddd;}

/* Show the dropdown menu (use JS to add this class to the .dropdown-content container when the user clicks on the dropdown button) */
.show {display:block;}

#trial2 {
  display: none;
}

.flex-container {
    display: flex;
    width: 110%;
}

.flex-child {
    flex: 1;
    width: 45%;
}  

.flex-child:first-child {
    width: 65%;
    margin-right: 2px;
} 

#tbl {
    font-family: Arial,Helvetica;
	font-size: 14pt;
    line-height: 30pt;
}

.selected {
  color: Red;
}
</style>

<!-- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -->

<!-- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -->

<!-- template for instructions -->
<div id = "instructionsEn" class = "questionsDiv">
    <h1>Instructions</h1>
    <!-- Insert text here -->
    <p> Your job is to answer each question regarding the quality of handwriting.</p>
    <div class="container">
        <div class="btn-holder">
            <button type="button" id = "startExperimentButtonEn" class = "button" >Start Evaluation</button>
        </div>
      </div>
    </div>

<!-- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -->
<!-- template for eoe -->
<div id = "EndOfEvaluation" class = "questionsDiv">
    <h1>End of Evaluation</h1>
    <p>Thank you for evaluating the subjects. Please press "Submit" button to send us your evaluation.</p>
    <div class="container">
        <div class="btn-holder">
            <button type="button" id = "Submit" class = "button" >Submit</button>
        </div>
      </div>
</div>

<!-- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -->
<!-- demographics -->
<div id=demographicsEn class = "demographicsDiv" >
    <h1 align="center">Please fill out the demographic information below.</h1>
    Your Name: <br>
    <input type="text" id="name" name="name" value=""><br> 
    Your Age: <br>
    <input type="text" id="ageEn" name="age" value=""><br>
    Your Gender:<br>
    <input id="genderEn" name="genderEn" type="radio" value="M" /> Male<br>
    <input id="genderEn" name="genderEn" type="radio" value="F" /> Female<br>
    School: <br>
    <input type="text" id="school" name="school" value=""><br>
    Level: 
    <label id="lblLevel" name="lblLevel" value="Elementary"></label>
    <select id="level" name="level" class="style12">
        <option value="1">Elementary</option>
        <option value="2">Preparatory</option>
        <option value="3">Secondary</option>
    </select> <br>
    Years of Teaching: <br>
    <input type="text" id="yearsTeaching" name="yearsTeaching" value=""><br>
    <div class="container">
        <div class="btn-holder">
            <button type="button" id = "nextToQ1" class = "button">Next</button>
        </div>
      </div>
    <p>&nbsp;</p>
</div>
     

<!-------------------------------------------------------------------------------------------------------------------------------------------------------------------------->
<!-- template for trials -->
<!-- here we define each of the trials with corresponding controls -->
<div id = "trial1" class = "questionsDiv" >
    <h3>Reference text</h3>
    <div class="container" >
        <div style="width:955px;height:126px;">  
            <canvas id="mainCanvas_2" width="955px" height="126px"></canvas>
        </div>
    </div>
    <h3 id="myHeader"> </h3>
    <div class="container" >
        <div style="width:1000px;height:750px;">  
            <canvas id="mainCanvas_1" width="1000px" height="750px"></canvas>
        </div>
    </div>

    <div class="flex-container">
        <div class="flex-child green">
            <h2 id = "myHeader_2"></h2>
            <h3>In the following questions please consider your overall assessment of the writing (scroll down):</h3>
            <p><b>Legibility</b> – How easy/difficult is it to read this person's handwriting?</p>
                <form name="legibility_radio" style="width:840px">
                    <div style="float: left; width: 150px">
                        <input  type = "radio" class = "responseButton"  name="diff" id="diff" type="radio" value="1" /> <label class="radio-label">hardly</label>
                    </div>
                    <div style="float: left; width: 150px">
                        <input  type = "radio" class = "responseButton"  name="diff" id="diff" type="radio" value="2" /> <label class="radio-label">normal</label>
                    </div>
                    <div style="float: left; width: 150px">
                        <input  type = "radio" class = "responseButton"  name="diff" id="diff" type="radio" value="3" /> <label class="radio-label">easily</label>
                    </div>
                </form>
            <br>
            <p><b>Space management</b>  – Was this person able to fit their writing in the space available? </p>
                <form name="space_radio" style="width:840px">
                    <div style="float: left; width: 150px">
                        <input  type = "radio" class = "responseButton"  name="space" id="space" type="radio" value="1" /> <label class="radio-label">inefficient</label>
                    </div>
                    <div style="float: left; width: 150px">
                        <input  type = "radio" class = "responseButton"  name="space" id="space" type="radio" value="2" /> <label class="radio-label">acceptable</label>
                    </div>
                    <div style="float: left; width: 150px">
                        <input  type = "radio" class = "responseButton"  name="space" id="space" type="radio" value="3" /> <label class="radio-label">efficient</label>
                    </div>
                </form>
            <br>
            <p><b>Style consistency</b>  – How consistent was this person in following specific style? </p>
                <form name="quality_radio" style="width:840px; padding: 0; margin-top: 5px">
                    <div style="float: left; width: 150px">
                        <input  type = "radio" class = "responseButton"  name="qual" id="qual" type="radio" value="1" /> <label class="radio-label">inconsistent </label>
                    </div>
                    <div style="float: left; width: 150px">
                        <input  type = "radio" class = "responseButton"  name="qual" id="qual" type="radio" value="2" /> <label class="radio-label">mixing</label>
                    </div>
                    <div style="float: left; width: 150px">
                        <input  type = "radio" class = "responseButton"  name="qual" id="qual" type="radio" value="3" /> <label class="radio-label">consistent</label>
                    </div>
                </form>
            <br>
            <p><b>Aesthetics</b>  – How beautiful is the handwriting of this person? </p>
                <form name="aesthetics_radio" style="width:840px; padding: 0; margin-top: 5px">
                    <div style="float: left; width: 150px">
                        <input  type = "radio" class = "responseButton"  name="aest" id="aest" type="radio" value="1" /> <label class="radio-label">not beautiful</label>
                    </div>
                    <div style="float: left; width: 150px">
                        <input  type = "radio" class = "responseButton"  name="aest" id="aest" type="radio" value="2" /> <label class="radio-label">normal</label>
                    </div>
                    <div style="float: left; width: 150px">
                        <input  type = "radio" class = "responseButton"  name="aest" id="aest" type="radio" value="3" /> <label class="radio-label">beautiful</label>
                    </div>
                </form>
            
            <br>
            <p><b>Legibility score: </b>  <input type="text" id="legibility_score" name="legibility" value=""></p>
        </div>
        
    </div>

</div>

<input id="Next" type="button"  class = "button" value="Next" onclick="increaseIdx();"/>
<input id="Previous" type="button"  class = "button" value="Previous" onclick="decreaseIdx();"/>

<!-- here where the JavaScript comes into action -->
<script >


let req = new XMLHttpRequest();
var currentTaskId=0;
var currentIdx = 0;
var sub=0;
var rep=0;
var obj ="";

req.onreadystatechange = () => {
  if (req.readyState == XMLHttpRequest.DONE) {
    obj = req.responseText;
  }
};

var apiKey = "$2b$10$GxlBjXk1TPiRn4AlVuL.aeI9qaKXRLc4QvhaWU4AQtAOTMlwmXNna";
//  all the participated experts are stored in the participated_experts.json
req.open("GET", "https://api.jsonbin.io/v3/b/64b9edb89d312622a3825454/latest", false);
req.setRequestHeader("X-Master-Key",apiKey);
req.send();

//
console.log("Outside of function");
console.log(obj);


listOfExperts = JSON.parse(obj);//to store the list of experts who already participated in the study
var allExpertsParticipatedArray = listOfExperts.record.experts;


//var subId = Math.round(1000*Math.random());//TODO: change to inputs from alert box
var subId = prompt("Please enter your name", "Jhon Doe"); // at the beginning of the program the expert enters his/her name
console.log(subId);
var foundExpertIdx =0;
var expertFound = false; 
for(var i = 0; i < allExpertsParticipatedArray.length; i++){ //iterate over list of experts who have already participated
    if(subId === allExpertsParticipatedArray[i].name){//if expert is found set the flag to true
        console.log("The expert's record is found");
        expertFound = true;
        foundExpertIdx = i;
        break; // exit loop if found
    }
    else{//else keep the flag  false
        foundExpertIdx = 0;
        expertFound = false;
    };
};
// timestamp for experts' json 
var newDate = new Date();
var foundBinId;
var doNotRecord = false; // if expert found the previous currentIdx result is displayed. Set this flag to true to prevent repeated entries in json file
console.log(expertFound);

//Get a list of input fields to sum
var elements = ["spelling","letter_form","letter_missing_parts","letter_connect","dots"];
var element_array = Array.prototype.slice.call(elements);

//this is to sum up dynamically the values in textboxes
$(".myclass").on("change", function(){
    var value1 = document.getElementById('spelling').value;
    var value2 = document.getElementById('letter_form').value;
    var value3 = document.getElementById('letter_missing_parts').value;
    var value4 = document.getElementById('letter_connect').value;
    var value5 = document.getElementById('dots').value;
    var sum = parseInt(value1 || '0') + parseInt(value2 || '0')+ parseInt(value3 || '0')+ parseInt(value4 || '0')+ parseInt(value5 || '0'); 
    $("#sum_of_errors").val(sum);
});

//  this is to sum up dynamically the values in radiobuttons
$(".responseButton").click(function() {
  var total = 0;
  $(".responseButton:checked").each(function() { total += +this.value; });
  $("#legibility_score").val(total);
});

if(expertFound){ //if name is found -- open expert's file
    doNotRecord = true;
    console.log("Expert found")
    let req_read = new XMLHttpRequest();
    foundBinId = allExpertsParticipatedArray[foundExpertIdx].binId;
    var foundExpertDataObj ="";

    req_read.onreadystatechange = () => {
        if (req_read.readyState == XMLHttpRequest.DONE) {
            foundExpertDataObj = req_read.responseText;
        }
    };

    // open the existing json file for the found expert
    req_read.open("GET", "https://api.jsonbin.io/v3/b/"+foundBinId+"/latest", false);
    req_read.setRequestHeader("X-Master-Key",apiKey);
    req_read.send();

    jsonCurrentExpData = JSON.parse(foundExpertDataObj);

    currentIdx = jsonCurrentExpData.record["idx"];

}
else{// else create a new json file and store the expert's name and binID
    currentIdx = 0;
    doNotRecord = false;
    console.log("No record found")
    jsonExpData_tmp = { 
		    "name":  subId,
		    "timestamp": newDate,
            "samples":[],
		  };
    jsonCurrentExpDataStr = JSON.stringify(jsonExpData_tmp);
    var txtObj = ""
    // open a new request to create the new bin for a new expert
    let req_create = new XMLHttpRequest();
    req_create.onreadystatechange = () => {
    if (req_create.readyState == XMLHttpRequest.DONE) {
        txtObj = req_create.responseText;
        console.log(txtObj);
        }
    };
    req_create.open("POST", "https://api.jsonbin.io/v3/b", false);
    req_create.setRequestHeader("Content-Type", "application/json");
    req_create.setRequestHeader("X-Master-Key", apiKey);
    req_create.setRequestHeader("X-Bin-Private",false);
    req_create.setRequestHeader("X-Bin-Name",subId);
    req_create.send(jsonCurrentExpDataStr);

    console.log("txtObj");
    console.log(txtObj);
    jsonFile = JSON.parse(txtObj);
    foundBinId = jsonFile.metadata.id;

    //assign the newly-created json to jsonCurrentExpData
    jsonCurrentExpData = jsonFile;

    console.log("created bin ID");
    console.log(foundBinId);

    listOfExperts.record['experts'].push({"name": subId,"binId":foundBinId});
    console.log(listOfExperts.record);
    jsonStr = JSON.stringify(listOfExperts.record);
    console.log(jsonStr);

    // update the records
    let reqUpdate = new XMLHttpRequest();

    reqUpdate.onreadystatechange = () => {
        if (reqUpdate.readyState == XMLHttpRequest.DONE) {
            console.log(reqUpdate.responseText);
        }
    };

    reqUpdate.open("PUT", "https://api.jsonbin.io/v3/b/64b9edb89d312622a3825454", false);
    reqUpdate.setRequestHeader("Content-Type", "application/json");
    reqUpdate.setRequestHeader("X-Master-Key", apiKey);
    reqUpdate.send(jsonStr);
    
};

console.log(jsonCurrentExpData.record);

// // test if the recorded new expert appears in the experts' JSON:
// for(var i = 0; i < allExpertsParticipatedArray.length; i++){ //iterate over list of experts who have already participated
//     console.log(allExpertsParticipatedArray[i]);
// }



//var lang = Math.round(Math.random());

imageFiles=[
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_28_Rep1_133434290837695388.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_28_Rep2_133434292537081018.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_28_Rep3_133434294237345768.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_28_Rep4_133434295753733768.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_28_Rep5_133434297394862524.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_28_Rep6_133434298984037615.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_29_Rep1_133437439192109068.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_29_Rep2_133437442131087420.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_29_Rep3_133437444163697656.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_29_Rep4_133437446195212708.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_29_Rep5_133437448279711941.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_29_Rep6_133437450774008126.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_30_Rep1_133439098968547344.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_30_Rep2_133439100671591296.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_30_Rep3_133439102216982785.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_30_Rep4_133439103737938741.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_30_Rep5_133439105200656384.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_30_Rep6_133439106776315048.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_31_Rep1_133439159812480958.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_31_Rep2_133439161780816304.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_31_Rep3_133439163690712472.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_31_Rep4_133439165710904300.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_31_Rep5_133439167774491453.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_31_Rep6_133439170050135537.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_32_Rep1_133439191469745150.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_32_Rep2_133439194638864006.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_32_Rep3_133439196384865272.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_32_Rep4_133439197759549423.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_32_Rep5_133439199243451633.png?raw=1',
    'https://github.com/vbabushkin/HandwritingLegibility/blob/main/handPosition_subj_32_Rep6_133439200594523498.png?raw=1'
];

var div1 = document.getElementById('trial1')
    //div2 = document.getElementById('trial2');


var nTrials=imageFiles.length;

console.log("Current IDX");
console.log(currentIdx);


if( typeof currentIdx === 'undefined'){
    dispInstructions();
    $('#trial1').hide();
    $('#Next').hide();
    $('#Previous').hide();
    currentIdx = 0;
}
if( currentIdx == 0){
    dispInstructions();
}
else{
    $('#trial1').show();
    $('#Next').show();
    $('#Previous').show();
    console.log('Current IDX in Q2:');
    console.log(currentIdx);
    let canvas = document.getElementById('mainCanvas_1');
    let ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, 1000, 750);

    // Create our image
    let newImage = new Image();
    newImage.src = imageFiles[currentIdx];
    // parsing the link to extract the unique ID
    console.log("currentTaskId:")
    console.log(currentTaskId)
    console.log("nTrials:")
    console.log(nTrials)
    currentTaskId = imageFiles[currentIdx].split("_")[4].split(".")[0];
    document.getElementById("myHeader").innerHTML = "Handwriting Sample "+(currentIdx+1) + " (ID #" +currentTaskId+")";
    //document.getElementById("myHeader_1").innerHTML = "Word-level Assessment of Handwriting Sample "+currentIdx;
    document.getElementById("myHeader_2").innerHTML = "Wholistic Assessment of Handwriting Sample "+(currentIdx+1);
    sub = parseInt(imageFiles[currentIdx].split("_")[2]);
    rep = parseInt(imageFiles[currentIdx].split("_")[3].slice(-1));
    // When it loads
    newImage.onload = () => {
        // Draw the image onto the context
        ctx.drawImage(newImage, 0, 0, 1000, 750);
    }

    // Create our image
    let refTxtImage = new Image();
    refTxtImage.src = "https://github.com/vbabushkin/HandwritingLegibility/blob/main/refText.png?raw=1";

    // When it loads
    refTxtImage.onload = () => {
        // Draw the image onto the context
        ctx2.drawImage(refTxtImage, 0, 0, 955, 126);
    }
    console.log('Current IDX in Q3:');
    console.log(currentIdx);

    let canvas2 = document.getElementById('mainCanvas_2');
    let ctx2 = canvas2.getContext('2d');
    ctx2.clearRect(0, 0, 1000, 750);

    var legibilityScoreInput= document.getElementById("legibility_score");
    legibilityScoreInput.value = jsonCurrentExpData.record['samples'][currentIdx]["legibility_score"];

    document.legibility_radio.diff[parseInt(jsonCurrentExpData.record['samples'][currentIdx]["legibility"])-1].checked=true;

    document.space_radio.space[parseInt(jsonCurrentExpData.record['samples'][currentIdx]["space_manag"])-1].checked=true;

    document.quality_radio.qual[parseInt(jsonCurrentExpData.record['samples'][currentIdx]["quality"])-1].checked=true;

    document.aesthetics_radio.aest[parseInt(jsonCurrentExpData.record['samples'][currentIdx]["aesthetics"])-1].checked=true;

}




/**
* for displaying instructions along with start button
*/
function dispInstructions(){
        $('#EndOfEvaluation').hide();
        $('#instructionsEn').show();
        $('#Next').hide();
        $('#Previous').hide();
        $('#startExperimentButtonEn').click(dispDemographics);
}


/**
* for displaying demographics
*/
function dispDemographics(){
    $('#instructionsEn').hide();
    $('#demographicsEn').show();
    
    var btn = document.getElementById('nextToQ1');
    btn.disabled= false;

    $('#nextToQ1').click(function(e) {

        var flag = 0;
        var isAgeNumeric = /^\d*$/.test(document.getElementById('ageEn').value); //Integer values (positive only):
        var isYearsOfTeachingNumeric = /^\d*$/.test(document.getElementById('yearsTeaching').value); //Integer values (positive only):
        var isSchoolString = /^[0-9a-zA-Z \-'_]+$/.test(document.getElementById("school").value);
        var isNameString = /^[A-Za-z \-'_]+$/.test(document.getElementById("name").value);

        if(document.getElementById("ageEn").value == ""){
            document.getElementById('ageEn').style.borderColor = "1px solid red";
            document.getElementById('ageEn').style.background =  "#FFCECE";

        }else{
            isAgeNumeric = /^\d*$/.test(document.getElementById('ageEn').value);
            if(isAgeNumeric==false){
                document.getElementById('ageEn').style.borderColor = "1px solid red";
                document.getElementById('ageEn').style.background =  "#FFCECE";

                }
            else{
                document.getElementById('ageEn').style.borderColor = "";
                document.getElementById('ageEn').style.background = "";
                flag = flag + 1;
            }
            
        }
        if(document.getElementById("school").value == ""){
            document.getElementById('school').style.borderColor = "1px solid red";
            document.getElementById('school').style.background =  "#FFCECE";

        }else{
            isSchoolString = /^[0-9a-zA-Z \-'_]+$/.test(document.getElementById("school").value);
            if(isSchoolString==false){
                document.getElementById('school').style.borderColor = "1px solid red";
                document.getElementById('school').style.background =  "#FFCECE";

                }
            else{
                document.getElementById('school').style.borderColor = "";
                document.getElementById('school').style.background = "";
                flag = flag + 1;
            }
        }
        
        if(document.getElementById("yearsTeaching").value == ""){
            document.getElementById('yearsTeaching').style.borderColor = "1px solid red";
            document.getElementById('yearsTeaching').style.background =  "#FFCECE";

        }else{
            isYearsOfTeachingNumeric = /^\d*$/.test(document.getElementById('yearsTeaching').value);
            if(isYearsOfTeachingNumeric==false){
                document.getElementById('yearsTeaching').style.borderColor = "1px solid red";
                document.getElementById('yearsTeaching').style.background =  "#FFCECE";
            }
            else{
                document.getElementById('yearsTeaching').style.borderColor = "";
                document.getElementById('yearsTeaching').style.background = "";
                flag = flag + 1;
            } 
        }
        
        if(document.getElementById("name").value == ""){
            document.getElementById('name').style.borderColor = "1px solid red";
            document.getElementById('name').style.background =  "#FFCECE";

        }else{
            isNameString = /^[A-Za-z \-'_]+$/.test(document.getElementById("name").value);
            if(isNameString==false){
                document.getElementById('name').style.borderColor = "1px solid red";
                document.getElementById('name').style.background =  "#FFCECE";

                }
            else{
                document.getElementById('name').style.borderColor = "";
                document.getElementById('name').style.background = "";
                flag = flag + 1;
            }
            
        }
        
        if($('input[name=genderEn]:checked').length <= 0){
            document.getElementById('genderEn').style.border = "1px solid red";
            document.getElementById('genderEn').style.background =  "#FFCECE";
            var isGenderValid = false;
            if (flag == 5)
                alert ( "Please choose your Gender: Male or Female" ); 
            else
                alert ( "Please choose your Gender: Male or Female and fill highlighted forms" ); 
        }else{
            document.getElementById('genderEn').style.border = "";
            document.getElementById('genderEn').style.background = "";
            var isGenderValid = true;
            flag = flag + 1;
        }
        
        if ( isGenderValid==true && flag == 5) {
            //record the outputs in text fields
            var textAgeEn = $('#ageEn').val();
            var textschool = $('#school').val();
            var textyearsTeaching = $('#yearsTeaching').val();
            var textname = $('#name').val();
            var el = document.getElementById('level');
            var textLevel = el.options[el.selectedIndex].innerHTML;

            console.log("level of teaching");
            console.log(textLevel);
            jsonCurrentExpData.record["expName"]=textname;
            jsonCurrentExpData.record["age"] =textAgeEn;
            jsonCurrentExpData.record["gender"] =$("input[type='radio'][name='genderEn']:checked").val();
            jsonCurrentExpData.record["school"] =textschool;
            jsonCurrentExpData.record["numYearsTeaching"] =textyearsTeaching;
            jsonCurrentExpData.record["level"]=textLevel;
            
            jsonStrDemographics = JSON.stringify(jsonCurrentExpData.record);

            console.log("foundBinId")
            console.log(foundBinId)

            console.log("jsonStrDemographics")
            console.log(jsonStrDemographics)
            // update the records in experts' json file:
            let reqUpdateDemographics = new XMLHttpRequest();

            reqUpdateDemographics.onreadystatechange = () => {
                if (reqUpdateDemographics.readyState == XMLHttpRequest.DONE) {
                    console.log(reqUpdateDemographics.responseText);
                }
            };
            
            reqUpdateDemographics.open("PUT", "https://api.jsonbin.io/v3/b/"+foundBinId, false);
            reqUpdateDemographics.setRequestHeader("Content-Type", "application/json");
            reqUpdateDemographics.setRequestHeader("X-Master-Key", apiKey);
            reqUpdateDemographics.send(jsonStrDemographics);
            if(currentIdx==0){
                dispQuestion2();
            }
            // else{
            //     increaseIdx();
            // }
        }
        else {
            e.preventDefault();
        }
    });         
}

/**
* for displaying Question2
*/
function dispQuestion2(){
    if(currentIdx<nTrials){
        $('#demographicsEn').hide();
        $('#trial1').show();
        $('#Next').show();
        $('#Previous').show();
        console.log('Current IDX in Q2:');
        console.log(currentIdx);
        let canvas = document.getElementById('mainCanvas_1');
        let ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, 1000, 750);
        // Create our image
        let newImage = new Image();
        newImage.src = imageFiles[currentIdx];
        // parsing the link to extract the unique ID
        currentTaskId = imageFiles[currentIdx].split("_")[4].split(".")[0];
        sub = parseInt(imageFiles[currentIdx].split("_")[2]);
        rep = parseInt(imageFiles[currentIdx].split("_")[3].slice(-1));
        document.getElementById("myHeader").innerHTML = "Handwriting Sample "+(currentIdx+1) + " (ID # " +currentTaskId+")";
        //document.getElementById("myHeader_1").innerHTML = "Word-level Assessment of Handwriting Sample "+currentTaskId;
        document.getElementById("myHeader_2").innerHTML = "Wholistic Assessment of Handwriting Sample "+(currentIdx+1);
        // When it loads
        newImage.onload = () => {
            // Draw the image onto the context
            ctx.drawImage(newImage, 0, 0, 1000, 750);
        }
        // Create our image
        let refTxtImage = new Image();dispEndOfEvaluation
        refTxtImage.src = "https://github.com/vbabushkin/HandwritingLegibility/blob/main/refText.png?raw=1";
        // When it loads
        refTxtImage.onload = () => {
            // Draw the image onto the context
            ctx2.drawImage(refTxtImage, 0, 0, 955, 126);
        }
        console.log('Current IDX in Q3:');
        console.log(currentIdx);
    }else{
        dispEndOfEvaluation();
    }
    let canvas2 = document.getElementById('mainCanvas_2');
    let ctx2 = canvas2.getContext('2d');
    ctx2.clearRect(0, 0, 1000, 750);
}


function increaseIdx(){

    // fill the json data
    var legibility  = $("input[type='radio'][name='diff']:checked").val();
    var space_manag = $("input[type='radio'][name='space']:checked").val();
    var quality = $("input[type='radio'][name='qual']:checked").val();
    var aesthetics = $("input[type='radio'][name='aest']:checked").val();
    var legibilityScore = $("#legibility_score").val();
    var legibilityScoreInput= document.getElementById("legibility_score");
    const optionContainerLegibility = document.querySelectorAll("input[name=diff]");
    const optionContainerSpace = document.querySelectorAll("input[name=space]");
    const optionContainerQual = document.querySelectorAll("input[name=qual]");
    const optionContainerAest = document.querySelectorAll("input[name=aest]");
    for (var i = 0; i < optionContainerLegibility.length; i++) {
            optionContainerLegibility[i].parentElement.classList.remove('selected');
        }
        for (var i = 0; i < optionContainerSpace.length; i++) {
            optionContainerSpace[i].parentElement.classList.remove('selected');
        }
        for (var i = 0; i < optionContainerQual.length; i++) {
            optionContainerQual[i].parentElement.classList.remove('selected');
        }
        for (var i = 0; i < optionContainerAest.length; i++) {
            optionContainerAest[i].parentElement.classList.remove('selected');
        }
    if($('input[type=radio][name=diff]:checked').length > 0 &
       $('input[type=radio][name=space]:checked').length > 0 &
       $('input[type=radio][name=qual]:checked').length > 0 &
       $('input[type=radio][name=aest]:checked').length > 0)//if checked all
    {
        console.log(doNotRecord)
        //if it is the first sample or the 
        console.log("number of elements in the array")
        console.log(jsonCurrentExpData.record.samples.length)
        console.log("current Idx in increase Idx before increasing")
        console.log(currentIdx)

        if(currentIdx == jsonCurrentExpData.record.samples.length){ // if the record does not exist then push and update
            //if the previous data are loaded do not update the json entry
            //if(doNotRecord){
            jsonCurrentExpData.record["idx"]=currentIdx;
            jsonCurrentExpData.record['samples'].push({"idx": currentIdx,
            "currentTaskId":currentTaskId,
            "sub":sub,
            "rep":rep,
            "legibility":legibility,
            "space_manag":space_manag,
            "quality":quality,
            "aesthetics":aesthetics,
            "legibility_score":legibilityScore});
        
            jsonCurrentExpDataStr = JSON.stringify(jsonCurrentExpData.record);

            // update the records in experts' json file:
            let reqUpdateSample = new XMLHttpRequest();

            reqUpdateSample.onreadystatechange = () => {
                if (reqUpdateSample.readyState == XMLHttpRequest.DONE) {
                    console.log(reqUpdateSample.responseText);
                }
            };

            reqUpdateSample.open("PUT", "https://api.jsonbin.io/v3/b/"+foundBinId, false);
            reqUpdateSample.setRequestHeader("Content-Type", "application/json");
            reqUpdateSample.setRequestHeader("X-Master-Key", apiKey);
            reqUpdateSample.send(jsonCurrentExpDataStr);


        }
        if(currentIdx < jsonCurrentExpData.record.samples.length){ // if returning from pressing "previous" button
            // record the fields' values into previous data 
            if(currentIdx!=0){
                jsonCurrentExpData.record.samples[currentIdx].legibility_score =legibilityScoreInput.value;
                jsonCurrentExpData.record.samples[currentIdx].legibility =legibility;
                jsonCurrentExpData.record.samples[currentIdx].space_manag =space_manag;
                jsonCurrentExpData.record.samples[currentIdx].quality =quality;
                jsonCurrentExpData.record.samples[currentIdx].aesthetics =aesthetics;
            }
        }

        doNotRecord=false; // set not recording to false
        // increase currentIdx
        currentIdx = currentIdx+1;
        dispQuestion2();
        console.log("Showing the preserved json data")
        console.log(jsonCurrentExpData.record);
        console.log("Current index in next after increasing");
        console.log(currentIdx)
        console.log("Length of the array after increasing");
        console.log(jsonCurrentExpData.record.samples.length);
        console.log(jsonCurrentExpData.record);

        // here we fill the textboxes with the elements of json corresponding to the next index
        if(currentIdx < jsonCurrentExpData.record.samples.length){
            if (jsonCurrentExpData.record['samples'][currentIdx]["legibility"]!=null) {
                document.legibility_radio.diff[parseInt(jsonCurrentExpData.record['samples'][currentIdx]["legibility"])-1].checked=true;
                console.log("legibility")
                console.log(jsonCurrentExpData.record['samples'][currentIdx]["legibility"])
            }else{
                $("input[type=radio][name=diff]").prop('checked', false);
            }
            if (jsonCurrentExpData.record['samples'][currentIdx]["space_manag"]!=null) {
                document.space_radio.space[parseInt(jsonCurrentExpData.record['samples'][currentIdx]["space_manag"])-1].checked=true;
                console.log("space_manag")
                console.log(jsonCurrentExpData.record['samples'][currentIdx]["space_manag"])
            }else{
                $("input[type=radio][name=space]").prop('checked', false);
            }
            if (jsonCurrentExpData.record['samples'][currentIdx]["quality"]!=null) {
                document.quality_radio.qual[parseInt(jsonCurrentExpData.record['samples'][currentIdx]["quality"])-1].checked=true;
                console.log("quality")
                console.log(jsonCurrentExpData.record['samples'][currentIdx]["quality"])
            }else{
                $("input[type=radio][name=qual]").prop('checked', false);
            }
            if (jsonCurrentExpData.record['samples'][currentIdx]["aesthetics"]!=null) {
                document.aesthetics_radio.aest[parseInt(jsonCurrentExpData.record['samples'][currentIdx]["aesthetics"])-1].checked=true;
                console.log("aesthetics")
                console.log(jsonCurrentExpData.record['samples'][currentIdx]["aesthetics"])
            }else{
                $("input[type=radio][name=aest]").prop('checked', false);
            }
            legibilityScoreInput.value = jsonCurrentExpData.record['samples'][currentIdx]["legibility_score"];
        }
        else{
            if (legibilityScoreInput.value !="") {
                legibilityScoreInput.value = "";
            }
            $("input[type=radio][name=diff]").prop('checked', false);
            $("input[type=radio][name=space]").prop('checked', false);
            $("input[type=radio][name=qual]").prop('checked', false);
            $("input[type=radio][name=aest]").prop('checked', false);
        }
        if(currentIdx>=nTrials){
            dispEndOfEvaluation();
        }
    }
    else{ //if any of radiobuttons is not checked
        if( $('input[type=radio][name=diff]:checked').length <= 0 & 
            $('input[type=radio][name=space]:checked').length > 0 &
            $('input[type=radio][name=qual]:checked').length > 0 &
            $('input[type=radio][name=aest]:checked').length > 0){
            for (var i = 0; i < optionContainerLegibility.length; i++) {
                    optionContainerLegibility[i].parentElement.classList.add('selected');
            }
            alert ( "Please evaluate the legibility" );
        }
        if( $('input[type=radio][name=diff]:checked').length > 0 &
            $('input[type=radio][name=space]:checked').length <= 0 &
            $('input[type=radio][name=qual]:checked').length > 0 &
            $('input[type=radio][name=aest]:checked').length > 0){
            for (var i = 0; i < optionContainerSpace.length; i++) {
                optionContainerSpace[i].parentElement.classList.add('selected');
            }
            alert ( "Please evaluate the space management" );
        }
        if( $('input[type=radio][name=diff]:checked').length > 0 & 
            $('input[type=radio][name=space]:checked').length > 0 &
            $('input[type=radio][name=qual]:checked').length <= 0 &
            $('input[type=radio][name=aest]:checked').length > 0){
            for (var i = 0; i < optionContainerQual.length; i++) {
                optionContainerQual[i].parentElement.classList.add('selected');
            }
            alert ( "Please evaluate the style consistency" );
        }
        if( $('input[type=radio][name=diff]:checked').length > 0 & 
            $('input[type=radio][name=space]:checked').length > 0 &
            $('input[type=radio][name=qual]:checked').length > 0 &
            $('input[type=radio][name=aest]:checked').length <= 0 ){
            for (var i = 0; i < optionContainerAest.length; i++) {
                optionContainerAest[i].parentElement.classList.add('selected');
            }
            alert ( "Please evaluate the aesthetics" );
        }
        // any two of them are not selcted
        if( $('input[type=radio][name=diff]:checked').length <= 0 & 
            $('input[type=radio][name=space]:checked').length <= 0 &
            $('input[type=radio][name=qual]:checked').length > 0 &
            $('input[type=radio][name=aest]:checked').length > 0){
            for (var i = 0; i < optionContainerLegibility.length; i++) {
                optionContainerLegibility[i].parentElement.classList.add('selected');
            }
            for (var i = 0; i < optionContainerSpace.length; i++) {
                optionContainerSpace[i].parentElement.classList.add('selected');
            }
            alert ( "Please evaluate the legibility and space management" );

        }
        if( $('input[type=radio][name=diff]:checked').length <= 0 & 
            $('input[type=radio][name=space]:checked').length > 0 &
            $('input[type=radio][name=qual]:checked').length <= 0 &
            $('input[type=radio][name=aest]:checked').length > 0){
            for (var i = 0; i < optionContainerLegibility.length; i++) {
                optionContainerLegibility[i].parentElement.classList.add('selected');
            }
            for (var i = 0; i < optionContainerQual.length; i++) {
                optionContainerQual[i].parentElement.classList.add('selected');
            }
            alert ( "Please evaluate the legibility and style consistency" );
        }
        if( $('input[type=radio][name=diff]:checked').length <= 0 & 
            $('input[type=radio][name=space]:checked').length > 0 &
            $('input[type=radio][name=qual]:checked').length > 0 &
            $('input[type=radio][name=aest]:checked').length <= 0){
            for (var i = 0; i < optionContainerLegibility.length; i++) {
                optionContainerLegibility[i].parentElement.classList.add('selected');
            }
            for (var i = 0; i < optionContainerAest.length; i++) {
                optionContainerAest[i].parentElement.classList.add('selected');
            }
            alert ( "Please evaluate the legibility and aesthetics" );
        }
        if( $('input[type=radio][name=diff]:checked').length > 0 & 
            $('input[type=radio][name=space]:checked').length <= 0 &
            $('input[type=radio][name=qual]:checked').length <= 0 &
            $('input[type=radio][name=aest]:checked').length > 0){
            for (var i = 0; i < optionContainerSpace.length; i++) {
                optionContainerSpace[i].parentElement.classList.add('selected');
            }
            for (var i = 0; i < optionContainerQual.length; i++) {
                optionContainerQual[i].parentElement.classList.add('selected');
            }
            alert ( "Please evaluate the space management and style consistency" );
        }
        if( $('input[type=radio][name=diff]:checked').length > 0 & 
            $('input[type=radio][name=space]:checked').length <= 0 &
            $('input[type=radio][name=qual]:checked').length > 0 &
            $('input[type=radio][name=aest]:checked').length <= 0){
            for (var i = 0; i < optionContainerSpace.length; i++) {
                optionContainerSpace[i].parentElement.classList.add('selected');
            }
            for (var i = 0; i < optionContainerAest.length; i++) {
                optionContainerAest[i].parentElement.classList.add('selected');
            }
            alert ( "Please evaluate the space management and aesthetics" );
        }
        if( $('input[type=radio][name=diff]:checked').length > 0 & 
            $('input[type=radio][name=space]:checked').length > 0 &
            $('input[type=radio][name=qual]:checked').length <= 0 &
            $('input[type=radio][name=aest]:checked').length <= 0){
            for (var i = 0; i < optionContainerQual.length; i++) {
                optionContainerQual[i].parentElement.classList.add('selected');
            }
            for (var i = 0; i < optionContainerAest.length; i++) {
                optionContainerAest[i].parentElement.classList.add('selected');
            }
            alert ( "Please evaluate the style consistency and aesthetics" );
        }
        // if any three of them are not selected
        if( $('input[type=radio][name=diff]:checked').length <= 0 & 
            $('input[type=radio][name=space]:checked').length <= 0 &
            $('input[type=radio][name=qual]:checked').length <= 0 &
            $('input[type=radio][name=aest]:checked').length > 0){
            for (var i = 0; i < optionContainerLegibility.length; i++) {
                optionContainerLegibility[i].parentElement.classList.add('selected');
            }
            for (var i = 0; i < optionContainerSpace.length; i++) {
                optionContainerSpace[i].parentElement.classList.add('selected');
            }
            for (var i = 0; i < optionContainerQual.length; i++) {
                optionContainerQual[i].parentElement.classList.add('selected');
            }
            alert ( "Please evaluate the legibility, space management and style consistency" );
        }
        if( $('input[type=radio][name=diff]:checked').length > 0 & 
            $('input[type=radio][name=space]:checked').length <= 0 &
            $('input[type=radio][name=qual]:checked').length <= 0 &
            $('input[type=radio][name=aest]:checked').length <= 0){
            for (var i = 0; i < optionContainerSpace.length; i++) {
                optionContainerSpace[i].parentElement.classList.add('selected');
            }
            for (var i = 0; i < optionContainerQual.length; i++) {
                optionContainerQual[i].parentElement.classList.add('selected');
            }
            for (var i = 0; i < optionContainerAest.length; i++) {
                optionContainerAest[i].parentElement.classList.add('selected');
            }
            alert ( "Please evaluate the space management, style consistency and aesthetics" );
        }
        if( $('input[type=radio][name=diff]:checked').length <= 0 & 
            $('input[type=radio][name=space]:checked').length > 0 &
            $('input[type=radio][name=qual]:checked').length <= 0 &
            $('input[type=radio][name=aest]:checked').length <= 0){
            for (var i = 0; i < optionContainerLegibility.length; i++) {
                optionContainerLegibility[i].parentElement.classList.add('selected');
            }
            for (var i = 0; i < optionContainerQual.length; i++) {
                optionContainerQual[i].parentElement.classList.add('selected');
            }
            for (var i = 0; i < optionContainerAest.length; i++) {
                optionContainerAest[i].parentElement.classList.add('selected');
            }
            alert ( "Please evaluate the legibility, style consistency and aesthetics" );
        }
        if( $('input[type=radio][name=diff]:checked').length <= 0 & 
            $('input[type=radio][name=space]:checked').length <= 0 &
            $('input[type=radio][name=qual]:checked').length > 0 &
            $('input[type=radio][name=aest]:checked').length <= 0){
            for (var i = 0; i < optionContainerLegibility.length; i++) {
                optionContainerLegibility[i].parentElement.classList.add('selected');
            }
            for (var i = 0; i < optionContainerSpace.length; i++) {
                optionContainerSpace[i].parentElement.classList.add('selected');
            }
            for (var i = 0; i < optionContainerAest.length; i++) {
                optionContainerAest[i].parentElement.classList.add('selected');
            }
            alert ( "Please evaluate the legibility, space management and aestheticsy" );
        }
        // if none of them checked
        if( $('input[type=radio][name=diff]:checked').length <= 0 & 
            $('input[type=radio][name=space]:checked').length <= 0 &
            $('input[type=radio][name=qual]:checked').length <= 0 &
            $('input[type=radio][name=aest]:checked').length <= 0){
            for (var i = 0; i < optionContainerLegibility.length; i++) {
                optionContainerLegibility[i].parentElement.classList.add('selected');
            }
            for (var i = 0; i < optionContainerSpace.length; i++) {
                optionContainerSpace[i].parentElement.classList.add('selected');
            }
            for (var i = 0; i < optionContainerQual.length; i++) {
                optionContainerQual[i].parentElement.classList.add('selected');
            }
            for (var i = 0; i < optionContainerAest.length; i++) {
                optionContainerAest[i].parentElement.classList.add('selected');
            }
            alert ( "Please evaluate the legibility, space management, style consistency and aestheticsy" );
        }

    } // if all radios are checked

}

function decreaseIdx(){
    $('#EndOfEvaluation').hide();
    console.log("current Idx in decrease Idx before decreasing")
    console.log(currentIdx)

    doNotRecord=true; // request not to record
    if(currentIdx>0){
        currentIdx = currentIdx-1;
    }
    else{
        currentIdx = 0;
    }
    console.log("current Idx in decrease Idx after decreasing")
    console.log(currentIdx)
    const optionContainerLegibility = document.querySelectorAll("input[name=diff]");
    const optionContainerSpace = document.querySelectorAll("input[name=space]");
    const optionContainerQual = document.querySelectorAll("input[name=qual]");
    const optionContainerAest = document.querySelectorAll("input[name=aest]");
    for (var i = 0; i < optionContainerLegibility.length; i++) {
            optionContainerLegibility[i].parentElement.classList.remove('selected');
        }
        for (var i = 0; i < optionContainerSpace.length; i++) {
            optionContainerSpace[i].parentElement.classList.remove('selected');
        }
        for (var i = 0; i < optionContainerQual.length; i++) {
            optionContainerQual[i].parentElement.classList.remove('selected');
        }
        for (var i = 0; i < optionContainerAest.length; i++) {
            optionContainerAest[i].parentElement.classList.remove('selected');
        }
    var legibilityScoreInput= document.getElementById("legibility_score");
    legibilityScoreInput.value = jsonCurrentExpData.record['samples'][currentIdx]["legibility_score"];
    console.log(jsonCurrentExpData.record['samples'][currentIdx].hasOwnProperty("legibility"))
    console.log(jsonCurrentExpData.record['samples'][currentIdx].hasOwnProperty("space_manag"))
    console.log(jsonCurrentExpData.record['samples'][currentIdx].hasOwnProperty("quality"))
    console.log(jsonCurrentExpData.record['samples'][currentIdx].hasOwnProperty("aesthetics"))
    if (jsonCurrentExpData.record['samples'][currentIdx]["legibility"]!=null) {
        document.legibility_radio.diff[parseInt(jsonCurrentExpData.record['samples'][currentIdx]["legibility"])-1].checked=true;
        console.log("legibility")
        console.log(jsonCurrentExpData.record['samples'][currentIdx]["legibility"])
    }else{
        $("input[type=radio][name=diff]").prop('checked', false);
    }
    if (jsonCurrentExpData.record['samples'][currentIdx]["space_manag"]!=null) {
        document.space_radio.space[parseInt(jsonCurrentExpData.record['samples'][currentIdx]["space_manag"])-1].checked=true;
        console.log("space_manag")
        console.log(jsonCurrentExpData.record['samples'][currentIdx]["space_manag"])
    }else{
        $("input[type=radio][name=space]").prop('checked', false);
    }
    if (jsonCurrentExpData.record['samples'][currentIdx]["quality"]!=null) {
        document.quality_radio.qual[parseInt(jsonCurrentExpData.record['samples'][currentIdx]["quality"])-1].checked=true;
        console.log("quality")
        console.log(jsonCurrentExpData.record['samples'][currentIdx]["quality"])
    }else{
        $("input[type=radio][name=qual]").prop('checked', false);
    }
    if (jsonCurrentExpData.record['samples'][currentIdx]["aesthetics"]!=null) {
        document.aesthetics_radio.aest[parseInt(jsonCurrentExpData.record['samples'][currentIdx]["aesthetics"])-1].checked=true;
        console.log("aesthetics")
        console.log(jsonCurrentExpData.record['samples'][currentIdx]["aesthetics"])
    }else{
        $("input[type=radio][name=aest]").prop('checked', false);
    }
    dispQuestion2();

}


/**
* for displaying eoe
*/
function dispEndOfEvaluation(){
        $('#trial1').hide();
        $('#Next').hide();
        //$('#Previous').hide();
        $('#EndOfEvaluation').show();
}

</script>